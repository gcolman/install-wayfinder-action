name: Run standard E2E
on:
  workflow_call:

env:
  VERSION: ${{ inputs.VERSION }}
  GIT_SHA: ${{ inputs.GIT_SHA }}
  GCP_SERVICE_ACCOUNT_KEY : ${{ secrets.GCP_SERVICE_ACCOUNT_KEY }}
  SOPS_DECRYPT_KEY_FROM_ENV: "GCP_SERVICE_ACCOUNT_KEY"
  RELEASE_BUCKET: ${{ inputs.RELEASE_BUCKET }}
  REGISTRY_ORG: ${{ inputs.REGISTRY_ORG }}

  CI_ENV: ${{ secrets.WAYFINDER_E2E_HOST_ENV }}
  WF_LICENSE_KEY: ${{ secrets.E2E_WF_LICENSE_KEY }}

  ENV_PREFIX: "e2e-${{ inputs.cloud }}"
  ENV_ID: "e2e-${{ inputs.cloud }}-${{ inputs.CLUSTER_NAME }}"

jobs:
  prepare-wf:
    runs-on: ubuntu-latest
    env:
    steps:
      - name: Checkout
        uses: actions/checkout@v3
        with:
          ref: ${{ env.GIT_SHA }}
      - name: Fetch Wayfinder CLI
        run: |
          export LOGS="$(pwd)/logs"
          export JSON_FILE="$(pwd)/env.json"
          export BIN="$(pwd)/bin"
          source ./hack/bin/get-wf-release.sh
      - name: Save env file
        uses: actions/upload-artifact@v3
        with:
          retention-days: 2
          name: env-info-${{ inputs.cloud }}
          path: env.json

  